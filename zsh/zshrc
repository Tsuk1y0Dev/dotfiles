# ===== OH MY ZSH =====
export ZSH="$HOME/.oh-my-zsh"
ZSH_THEME="powerlevel10k/powerlevel10k"

# Плагины (аккуратно, много плагинов замедляют запуск)
plugins=(
    git
    sudo
    zsh-autosuggestions
    zsh-syntax-highlighting
    you-should-use
    archlinux
    systemd
)

source $ZSH/oh-my-zsh.sh

# ===== POWERLEVEL10K =====
[[ ! -f ~/.p10k.zsh ]] || source ~/.p10k.zsh

# ===== НАСТРОЙКА ОКРУЖЕНИЯ =====
export EDITOR='nvim'
export VISUAL='nvim'
export PAGER='less'

# Для корректного отображения русского и символов
export LANG=en_US.UTF-8
export LC_CTYPE=ru_RU.UTF-8
export LC_ALL=en_US.UTF-8

# ===== АЛИАСЫ (СОКРАЩЕНИЯ) =====
# Rice Management
alias rs='rice-boss switch'    # Выбрать райс из списка (fzf)
alias r-save='rice-boss save'  # Сохранить текущий сет в новый профиль
alias r-list='rice-boss list'  # Список всех райсов

# Rice Management
alias rs='rice-boss switch'    # Выбрать райс из списка (fzf)
alias r-save='rice-boss save'  # Сохранить текущий сет в новый профиль
alias r-list='rice-boss list'  # Список всех райсов
# Работа со скриптами и конфигами
alias dots='~/bin/dots-sync'     # Бэкап дотов
alias strace='~/bin/sys-trace'   # Чек ошибок системы
alias perf='~/bin/toggle-hypr'   # Выкл анимации
alias getfonts='~/bin/get-fonts' # Список шрифтов

# Безопасность
alias rm='rm -i'
alias cp='cp -i'
alias mv='mv -i'

# Современные замены старым командам
alias ls='eza --icons --group-directories-first'
alias ll='eza -la --icons --group-directories-first --git'
alias lt='eza --tree --icons --level=2'
alias cat='bat --paging=never'
alias grep='rg'
alias find='fd'

# Системные команды
alias update='sudo pacman -Syu'
alias cleanup='pacman -Qtdq && echo "Удалить эти сироты? (y/n)" && read ans && [[ $ans == "y" ]] && sudo pacman -Rns $(pacman -Qtdq)'
alias services='systemctl list-units --type=service --state=running'
alias disks='lsblk -f'

# Гипер-удобные
alias zshrc='${EDITOR} ~/.zshrc && source ~/.zshrc'
alias ohmyzsh='${EDITOR} ~/.oh-my-zsh'
alias dotfiles='cd ~/.config && ${EDITOR} .'
alias ..='cd ..'
alias ...='cd ../..'
alias in='sudo pacman -S'

# Git (дополнение к плагину git)
alias gs='git status'
alias ga='git add'
alias gc='git commit'
alias gp='git push'
alias gl='git log --oneline --graph --all'

# --- AI STACK 2026 (Local & Secure) ---
alias ai-start='sudo systemctl start ollama'
alias ai-stop='sudo systemctl stop ollama'
alias ai-status='systemctl status ollama'

# Кодинг (7B - быстро, 14B - для сложных задач)
alias ai-code='ollama run qwen2.5-coder:7b'
alias ai-pro='ollama run qwen2.5-coder:14b'

# Логика и рассуждения
alias ai-think='ollama run deepseek-r1:7b'

# Мониторинг ресурсов
alias ai-ps="ollama ps"
alias ai-kill="ollama stop \$(ollama ps | awk 'NR>1 {print \$1}')"

# Общение и общие вопросы
alias ai-fast='ollama run phi4:latest'
alias ai-chat='ollama run llama3:8b'

# --- Интерфейс Open WebUI (Docker) ---
alias ai-ui-on="docker start open-webui"
alias ai-ui-off="docker stop open-webui"
# ===== НАСТРОЙКИ ZSH =====

# История
HISTFILE=~/.zsh_history
HISTSIZE=100000
SAVEHIST=100000
setopt appendhistory
setopt sharehistory
setopt histignorealldups
setopt histignorespace

# Автодополнение
autoload -Uz compinit
compinit
zstyle ':completion:*' menu select
zstyle ':completion:*' matcher-list 'm:{a-zA-Z}={A-Za-z}'
zstyle ':completion:*' list-colors "${(s.:.)LS_COLORS}"

# Разное
setopt autocd           # cd без команды cd
setopt correct          # Исправлять опечатки
setopt nocaseglob       # Нечувствительность к регистру
setopt extendedglob     # Расширенные шаблоны
unsetopt beep           # Без звука

# ===== МОЩНЫЕ ИНСТРУМЕНТЫ =====

# FZF (нечёткий поиск)
[ -f /usr/share/fzf/key-bindings.zsh ] && source /usr/share/fzf/key-bindings.zsh
[ -f /usr/share/fzf/completion.zsh ] && source /usr/share/fzf/completion.zsh
export FZF_DEFAULT_OPTS='--height 40% --border --preview "bat --color=always {}"'

# Zoxide (умный cd)
eval "$(zoxide init zsh)"

# YOU-SHOULD-USE (напоминает про алиасы)
export YSU_MESSAGE_POSITION="after"

# ===== ФУНКЦИИ =====

# Создать директорию и перейти в неё
mkcd() { mkdir -p "$1" && cd "$1"; }

# Поиск процесса
psgrep() { ps aux | grep -i "$1" | grep -v grep; }

# Показать размер директорий
ds() { du -sh * | sort -h; }

# Копировать вывод команды в буфер
clip() {
  # Сначала проверяем, есть ли такое сокращение (алиас)
  local cmd_expanded=$(alias "$1" | cut -d'=' -f2- | sed "s/'//g")
  
  if [ -n "$cmd_expanded" ]; then
    # Если это алиас, выполняем его с остальными аргументами
    shift
    eval "$cmd_expanded $@" | wl-copy
  else
    # Если это обычная команда
    "$@" | wl-copy
  fi
}
# Разархивировать любой ахив
ex () {
  if [ -f $1 ] ; then
    case $1 in
      *.tar.bz2)   tar xjf $1   ;;
      *.tar.gz)    tar xzf $1   ;;
      *.bz2)       bunzip2 $1   ;;
      *.rar)       unrar x $1   ;;
      *.gz)        gunzip $1    ;;
      *.tar)       tar xf $1    ;;
      *.tbz2)      tar xjf $1   ;;
      *.tgz)       tar xzf $1   ;;
      *.zip)       unzip $1     ;;
      *.Z)         uncompress $1;;
      *.7z)        7z x $1      ;;
      *)           echo "'$1' cannot be extracted via ex()" ;;
    esac
  else
    echo "'$1' is not a valid file"
  fi
}
export PATH="$HOME/bin:$PATH"
# ===== ПРИВЕТСТВИЕ ====

# ===== СИНТАКСИЧЕСКАЯ ПРОВЕРКА =====
# Если нужно проверить конфиг: zsh -n ~/.zshrc
